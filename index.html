<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boda de Mariana y Rogelio</title>
    <!-- Carga de la fuente Inter desde Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Carga de Tailwind CSS para un diseño moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Tailwind gray-100 */
        }
        /* Estilos personalizados para el contenedor de la aplicación */
        .app-container {
            max-width: 960px;
            margin: 0 auto;
            padding: 2rem;
        }
        /* Estilos para el efecto de sombra en botones */
        .btn-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        /* Estilo para las pestañas de navegación */
        .tab-button.active {
            background-color: #ffffff; /* Fondo blanco para la pestaña activa */
            color: #ef4444; /* Texto rojo para la pestaña activa */
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); /* Sombra superior sutil */
        }
        /* Estilos para la animación de pulso en el contador de votos */
        @keyframes pulse-once {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pulse-animation {
            animation: pulse-once 0.5s ease-in-out;
        }
        /* Estilos para el modal personalizado */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .modal.open {
            display: flex;
            opacity: 1;
            transform: scale(1);
        }
        /* Estilos para el spinner de carga */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ef4444;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

    <!-- Encabezado y barra de navegación -->
    <header class="bg-red-500 p-4 shadow-lg sticky top-0 z-50">
        <div class="app-container flex flex-col items-center">
            <h1 class="text-white text-3xl font-bold mb-4 text-center">Boda de Mariana y Rogelio</h1>
            <nav class="w-full">
                <div class="flex justify-around bg-red-500 rounded-full shadow-inner">
                    <button id="tab-music" class="tab-button w-1/3 py-2 px-4 text-white font-semibold rounded-full active transition duration-300 ease-in-out hover:bg-white hover:text-red-500">Música</button>
                    <button id="tab-story" class="tab-button w-1/3 py-2 px-4 text-white font-semibold rounded-full transition duration-300 ease-in-out hover:bg-white hover:text-red-500">Nuestra Historia</button>
                    <button id="tab-trivia" class="tab-button w-1/3 py-2 px-4 text-white font-semibold rounded-full transition duration-300 ease-in-out hover:bg-white hover:text-red-500">Trivia</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Contenido principal de la aplicación -->
    <main class="app-container flex-grow py-8">
        
        <!-- Sección 1: Música para Ensamble -->
        <section id="content-music" class="tab-content bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Música para Ensamble 🎶</h2>
            <p class="text-gray-600 mb-6">Ayúdanos a elegir la banda sonora de nuestra boda. ¡Vota por tus canciones favoritas!</p>
            <div id="music-list-container" class="space-y-4">
                <!-- La lista de canciones se renderizará aquí -->
            </div>
            <div class="mt-6 flex justify-end">
                <button id="submit-votes-btn" class="bg-red-500 text-white font-semibold py-2 px-6 rounded-full btn-shadow transition duration-300 ease-in-out hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                    <span id="submit-votes-text">Enviar Votos</span>
                    <div id="submit-votes-spinner" class="loader ml-2 hidden"></div>
                </button>
            </div>
        </section>

        <!-- Sección 2: Nuestra Historia -->
        <section id="content-story" class="tab-content hidden bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Nuestra Historia: La Banda Sonora del Amor ❤️</h2>
            <p class="text-gray-600 mb-6">Revive con nosotros los momentos clave de nuestra historia a través de las canciones que la acompañaron.</p>
            <div id="story-milestones-container" class="space-y-8">
                <!-- Los hitos de la historia se renderizarán aquí -->
            </div>
        </section>

        <!-- Sección 3: Trivia de Amor -->
        <section id="content-trivia" class="tab-content hidden bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Trivia de Amor: ¿Cuánto nos conoces? 🤔</h2>
            <p class="text-gray-600 mb-6">Pon a prueba tu conocimiento sobre nuestra historia y gana un lugar en la tabla de clasificación. ¡Buena suerte!</p>
            
            <div id="trivia-nickname-input" class="mb-4">
                <label for="nickname" class="block text-gray-700 font-semibold mb-2">Introduce tu nickname:</label>
                <input type="text" id="nickname" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Tu nombre">
                <button id="start-trivia-btn" class="bg-red-500 text-white font-semibold py-2 px-6 rounded-full btn-shadow mt-4 transition duration-300 ease-in-out hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">Comenzar Trivia</button>
            </div>
            
            <div id="trivia-container" class="hidden">
                <div id="trivia-question-card" class="bg-gray-50 p-6 rounded-lg mb-6 shadow-md">
                    <p id="trivia-question" class="text-lg font-semibold mb-4 text-gray-800">Pregunta de ejemplo...</p>
                    <div id="trivia-options" class="space-y-2">
                        <!-- Las opciones de respuesta se renderizarán aquí -->
                    </div>
                </div>
                <div id="trivia-feedback" class="text-center text-lg font-semibold mb-4 hidden"></div>
                <div id="trivia-controls" class="flex justify-between">
                    <button id="next-question-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded-full btn-shadow transition duration-300 ease-in-out hover:bg-gray-300 hidden">Siguiente Pregunta</button>
                    <button id="submit-answer-btn" class="bg-red-500 text-white font-semibold py-2 px-6 rounded-full btn-shadow transition duration-300 ease-in-out hover:bg-red-600">
                        <span id="submit-answer-text">Enviar Respuesta</span>
                        <div id="submit-answer-spinner" class="loader ml-2 hidden"></div>
                    </button>
                </div>
            </div>

            <div id="trivia-results" class="hidden mt-8">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Puntaje Final: <span id="final-score" class="text-red-500">0</span></h3>
                <button id="restart-trivia-btn" class="bg-red-500 text-white font-semibold py-2 px-6 rounded-full btn-shadow transition duration-300 ease-in-out hover:bg-red-600">Reiniciar Trivia</button>
            </div>
            
            <div id="trivia-leaderboard" class="mt-8">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Tabla de Clasificación 🏆</h3>
                <div class="bg-white p-4 rounded-lg shadow-md">
                    <div class="flex font-bold border-b-2 border-gray-200 pb-2 mb-2">
                        <span class="w-1/2">Nombre</span>
                        <span class="w-1/2 text-right">Puntaje</span>
                    </div>
                    <div id="leaderboard-list" class="space-y-2">
                        <!-- La tabla de clasificación se renderizará aquí -->
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Pie de página -->
    <footer class="bg-gray-800 text-white text-center p-4 mt-8">
        <p>Con amor, Mariana y Rogelio &copy; <span id="current-year"></span></p>
    </footer>

    <!-- Modal de mensajes personalizado -->
    <div id="custom-modal" class="modal">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm transform transition-all duration-300">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-xl font-bold text-gray-800"></h3>
                <button id="modal-close-btn" class="text-gray-500 hover:text-gray-700 transition-colors">&times;</button>
            </div>
            <p id="modal-message" class="text-gray-600 mb-4"></p>
            <div class="flex justify-end">
                <button id="modal-ok-btn" class="bg-red-500 text-white font-semibold py-2 px-6 rounded-full btn-shadow hover:bg-red-600 transition-colors">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Script principal de la aplicación -->
    <script>
        // --- Referencias a elementos del DOM ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const musicListContainer = document.getElementById('music-list-container');
        const submitVotesBtn = document.getElementById('submit-votes-btn');
        const submitVotesText = document.getElementById('submit-votes-text');
        const submitVotesSpinner = document.getElementById('submit-votes-spinner');
        const storyMilestonesContainer = document.getElementById('story-milestones-container');
        const triviaNicknameInput = document.getElementById('trivia-nickname-input');
        const startTriviaBtn = document.getElementById('start-trivia-btn');
        const triviaContainer = document.getElementById('trivia-container');
        const triviaQuestion = document.getElementById('trivia-question');
        const triviaOptions = document.getElementById('trivia-options');
        const triviaFeedback = document.getElementById('trivia-feedback');
        const submitAnswerBtn = document.getElementById('submit-answer-btn');
        const submitAnswerText = document.getElementById('submit-answer-text');
        const submitAnswerSpinner = document.getElementById('submit-answer-spinner');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const triviaResults = document.getElementById('trivia-results');
        const finalScoreSpan = document.getElementById('final-score');
        const restartTriviaBtn = document.getElementById('restart-trivia-btn');
        const leaderboardList = document.getElementById('leaderboard-list');
        const customModal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalOkBtn = document.getElementById('modal-ok-btn');

        // --- Datos de la aplicación (ahora locales) ---
        let musicData = [
            { id: "1", title: "Perfect", artist: "Ed Sheeran", genre: "Balada Romántica", dedication: "Para el amor que encontré en ti.", votes: 0 },
            { id: "2", title: "La Vie en Rose", artist: "Louis Armstrong", genre: "Jazz Suave", dedication: "Nuestro primer baile, un recuerdo para siempre.", votes: 0 },
            { id: "3", title: "A Sky Full of Stars", artist: "Coldplay", genre: "Éxito Moderno", dedication: "Por todos los momentos inolvidables juntos.", votes: 0 },
            { id: "4", title: "Canon en Re Mayor", artist: "Pachelbel", genre: "Clásico", dedication: "La melodía de nuestra felicidad.", votes: 0 },
            { id: "5", title: "Fly Me to the Moon", artist: "Frank Sinatra", genre: "Jazz Suave", dedication: "Nuestro viaje juntos, hacia las estrellas.", votes: 0 },
            { id: "6", title: "Thinking Out Loud", artist: "Ed Sheeran", genre: "Balada Romántica", dedication: "Cada día te amo más que el anterior.", votes: 0 },
            { id: "7", title: "Happy", artist: "Pharrell Williams", genre: "Éxito Moderno", dedication: "Celebrando la alegría de estar juntos.", votes: 0 },
            { id: "8", title: "Claro de Luna", artist: "Debussy", genre: "Clásico", dedication: "Nuestras noches tranquilas y románticas.", votes: 0 },
            { id: "9", title: "L-O-V-E", artist: "Nat King Cole", genre: "Jazz Suave", dedication: "Definición de nuestro amor.", votes: 0 },
            { id: "10", title: "Shape of You", artist: "Ed Sheeran", genre: "Éxito Moderno", dedication: "El ritmo de nuestro corazón.", votes: 0 }
        ];

        const storyData = [
            { name: "Nuestro Primer Café ☕", songTitle: "Como yo te amo", artist: "Rocío Jurado", anecdote: "Fue un día lluvioso, nos refugiamos en una pequeña cafetería y la magia comenzó. El tiempo se detuvo.", imageUrl: "https://placehold.co/400x250/FCA5A5/ffffff?text=Nuestro+Primer+Cafe" },
            { name: "El Primer Te Amo 🥰", songTitle: "Para amarnos más", artist: "Mijares", anecdote: "En un atardecer en la playa, con el mar de fondo, Rogelio me dijo que me amaba por primera vez. Una canción de Mijares sonaba a lo lejos.", imageUrl: "https://placehold.co/400x250/F87171/ffffff?text=El+Primer+Te+Amo" },
            { name: "El Viaje a Oaxaca ✈️", songTitle: "México en la piel", artist: "Luis Miguel", anecdote: "Nuestro primer viaje juntos. Descubrimos la belleza de Oaxaca y nuestra conexión se hizo más profunda.", imageUrl: "https://placehold.co/400x250/EF4444/ffffff?text=Viaje+a+Oaxaca" },
            { name: "Una Noche de Cine 🍿", songTitle: "Contigo en la distancia", artist: "Céline Dion", anecdote: "Vimos nuestra película favorita, 'Casablanca'. Fue la primera de muchas noches de cine en casa. Siempre hay un momento para ti.", imageUrl: "https://placehold.co/400x250/DC2626/ffffff?text=Noche+de+Cine" },
            { name: "Pedida de Mano 💍", songTitle: "El anillo", artist: "Jennifer López", anecdote: "No fue en París, ni en la playa. Fue en el balcón de la casa, con nuestros dos perros de testigos. El momento más sencillo y perfecto.", imageUrl: "https://placehold.co/400x250/B91C1C/ffffff?text=Pedida+de+Mano" },
            { name: "El Baile en la Cocina 💃🕺", songTitle: "Unchained Melody", artist: "The Righteous Brothers", anecdote: "No necesitamos salir a bailar. Nuestras noches de baile favorito son en la cocina, mientras cocinamos. La mejor pista de baile es nuestra casa.", imageUrl: "https://placehold.co/400x250/991B1B/ffffff?text=Baile+en+la+Cocina" },
            { name: "Cumpleaños de Mariana 🎂", songTitle: "La mejor canción", artist: "El Barrio", anecdote: "El día en que celebramos el cumpleaños de Mariana en su restaurante favorito. No se olvidará jamás.", imageUrl: "https://placehold.co/400x250/7F1D1D/ffffff?text=Cumpleaños+Mariana" },
            { name: "Cumpleaños de Rogelio 🥳", songTitle: "Te amé", artist: "Vico C", anecdote: "El día en que Mariana le preparó la fiesta de cumpleaños sorpresa. La primera de muchas juntas. Te amo, mi vida.", imageUrl: "https://placehold.co/400x250/6E1E1E/ffffff?text=Cumpleaños+Rogelio" },
            { name: "La Visita a la Abuela 👵", songTitle: "Mi gran noche", artist: "Raphael", anecdote: "Nos presentó a la abuela de Mariana. La amamos mucho y nos ha dado todo su amor y cariño. Te amamos.", imageUrl: "https://placehold.co/400x250/4A0D0D/ffffff?text=Visita+a+Abuela" },
            { name: "El Día de San Valentín 💖", songTitle: "Qué bonito", artist: "Rosario Flores", anecdote: "El día de San Valentín. Fue muy especial. Los detalles, la cena, la noche y el amanecer. Todo fue perfecto.", imageUrl: "https://placehold.co/400x250/2D0808/ffffff?text=Dia+San+Valentin" }
        ];

        const triviaData = [
            { question: "¿Cuál es el postre favorito de Rogelio que Mariana prepara?", options: ["Pastel de chocolate", "Cheesecake", "Flan de la abuela", "Tarta de limón"], answer: "Flan de la abuela" },
            { question: "¿Dónde fue la primera cita oficial de Mariana y Rogelio?", options: ["En un cine", "En un restaurante de sushi", "En un parque", "En una cafetería"], answer: "En una cafetería" },
            { question: "¿Cuál es la película que más veces han visto juntos?", options: ["The Notebook", "La La Land", "Casablanca", "Before Sunrise"], answer: "Casablanca" },
            { question: "¿Qué actividad les gusta hacer más los fines de semana?", options: ["Ir de compras", "Ver series en el sofá", "Hacer senderismo", "Salir de fiesta"], answer: "Ver series en el sofá" },
            { question: "¿Cuál es el apodo cariñoso de Rogelio para Mariana?", options: ["Mi vida", "Princesa", "Chaparrita", "Pollito"], answer: "Mi vida" },
            { question: "¿Qué tipo de comida prefieren para una cena romántica?", options: ["Italiana", "Mexicana", "Japonesa", "Francesa"], answer: "Italiana" },
            { question: "¿Cuál es el lugar soñado para su luna de miel?", options: ["París", "Las Maldivas", "Japón", "Grecia"], answer: "Japón" },
            { question: "¿Qué mascota tienen juntos?", options: ["Un perro", "Un gato", "Un hámster", "Dos perros"], answer: "Dos perros" },
            { question: "¿Cuál es el hobby secreto de Mariana?", options: ["Bailar salsa", "Hacer pasteles", "Coleccionar vinilos", "Pintar al óleo"], answer: "Pintar al óleo" },
            { question: "¿En qué mes se conocieron por primera vez?", options: ["Enero", "Marzo", "Junio", "Septiembre"], answer: "Septiembre" }
        ];

        let votedSongs = new Set();
        let currentTriviaQuestionIndex = 0;
        let triviaScore = 0;
        let nickname = '';
        let leaderboardScores = []; // Almacenamiento local para los puntajes

        // --- Funciones de Utilidad ---

        /**
         * Muestra el modal de mensajes personalizado.
         * @param {string} title - El título del modal.
         * @param {string} message - El mensaje a mostrar.
         */
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            customModal.classList.add('open');
        }

        /**
         * Oculta el modal de mensajes personalizado.
         */
        function hideModal() {
            customModal.classList.remove('open');
        }

        /**
         * Muestra u oculta un spinner de carga en un botón.
         * @param {HTMLElement} buttonElement - El botón.
         * @param {HTMLElement} textElement - El elemento de texto dentro del botón.
         * @param {HTMLElement} spinnerElement - El elemento spinner.
         * @param {boolean} isLoading - Si se debe mostrar el spinner.
         */
        function toggleSpinner(buttonElement, textElement, spinnerElement, isLoading) {
            if (isLoading) {
                buttonElement.disabled = true;
                textElement.classList.add('hidden');
                spinnerElement.classList.remove('hidden');
            } else {
                buttonElement.disabled = false;
                textElement.classList.remove('hidden');
                spinnerElement.classList.add('hidden');
            }
        }

        /**
         * Cierra el modal cuando se hace clic en el botón 'Aceptar' o en la 'X'.
         */
        modalOkBtn.addEventListener('click', hideModal);
        modalCloseBtn.addEventListener('click', hideModal);

        // --- Lógica de la Sección 1: Música para Ensamble ---

        /**
         * Renderiza la lista de canciones en el DOM.
         */
        function renderMusicList() {
            // Ordenar por votos de mayor a menor
            const sortedSongs = [...musicData].sort((a, b) => b.votes - a.votes);
            musicListContainer.innerHTML = '';
            sortedSongs.forEach(song => {
                const isVoted = votedSongs.has(song.id);
                const songCard = document.createElement('div');
                songCard.className = `flex items-center bg-gray-50 p-4 rounded-lg shadow-sm transition-transform duration-200 ease-in-out hover:scale-105 ${isVoted ? 'opacity-70' : ''}`;
                
                songCard.innerHTML = `
                    <input type="checkbox" data-song-id="${song.id}" ${isVoted ? 'disabled' : ''} class="form-checkbox h-5 w-5 text-red-500 rounded focus:ring-red-500 transition-colors">
                    <div class="ml-4 flex-grow">
                        <p class="font-bold text-gray-800">${song.title} <span class="font-normal text-sm text-gray-500">- ${song.artist}</span></p>
                        <p class="text-xs text-gray-400 mt-1" title="${song.dedication}">${song.genre}</p>
                    </div>
                    <div class="flex items-center ml-auto">
                        <span data-votes-id="${song.id}" class="votes-counter text-xl font-bold text-red-500 mr-2">${song.votes}</span>
                        <span class="text-sm text-gray-500">votos</span>
                    </div>
                `;
                musicListContainer.appendChild(songCard);
            });
        }

        /**
         * Maneja el envío de votos a la lista local.
         */
        submitVotesBtn.addEventListener('click', () => {
            const selectedSongs = document.querySelectorAll('input[data-song-id]:checked');
            if (selectedSongs.length === 0) {
                showModal("Advertencia", "Por favor, selecciona al menos una canción para votar.");
                return;
            }

            toggleSpinner(submitVotesBtn, submitVotesText, submitVotesSpinner, true);

            try {
                for (const checkbox of selectedSongs) {
                    const songId = checkbox.dataset.songId;
                    const songToUpdate = musicData.find(s => s.id === songId);
                    if (songToUpdate) {
                        songToUpdate.votes++;
                        votedSongs.add(songId);
                    }
                }
                
                // Re-renderizar la lista para mostrar los votos actualizados
                renderMusicList();

                showModal("Éxito", "¡Gracias por tus votos!");
            } catch (error) {
                console.error("Error al enviar votos:", error);
                showModal("Error", "Hubo un problema al procesar tus votos. Por favor, inténtalo de nuevo.");
            } finally {
                toggleSpinner(submitVotesBtn, submitVotesText, submitVotesSpinner, false);
            }
        });
        
        // --- Lógica de la Sección 2: Nuestra Historia ---
        
        /**
         * Renderiza los hitos de la historia en el DOM.
         */
        function renderStoryMilestones() {
            storyMilestonesContainer.innerHTML = '';
            storyData.forEach(milestone => {
                const milestoneCard = document.createElement('div');
                milestoneCard.className = `flex flex-col md:flex-row bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 ease-in-out hover:shadow-2xl`;
                milestoneCard.innerHTML = `
                    <div class="md:w-1/2 overflow-hidden">
                        <img src="${milestone.imageUrl}" alt="${milestone.name}" class="w-full h-full object-cover transform transition-transform duration-500 hover:scale-110">
                    </div>
                    <div class="md:w-1/2 p-6 flex flex-col justify-center">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${milestone.name}</h3>
                        <p class="text-sm font-semibold text-red-500 mb-2">${milestone.songTitle} - ${milestone.artist}</p>
                        <p class="text-gray-600">${milestone.anecdote}</p>
                    </div>
                `;
                storyMilestonesContainer.appendChild(milestoneCard);
            });
        }
        
        // --- Lógica de la Sección 3: Trivia de Amor ---

        /**
         * Renderiza la tabla de clasificación.
         */
        function renderLeaderboard() {
            // Ordenar por puntaje de mayor a menor
            leaderboardScores.sort((a, b) => b.score - a.score);
            leaderboardList.innerHTML = '';
            leaderboardScores.forEach((score, index) => {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0';
                scoreItem.innerHTML = `
                    <span class="text-gray-800 font-semibold">${index + 1}. ${score.nickname}</span>
                    <span class="text-red-500 font-bold">${score.score} puntos</span>
                `;
                leaderboardList.appendChild(scoreItem);
            });
        }

        /**
         * Inicia el juego de trivia.
         */
        function startTrivia() {
            nickname = document.getElementById('nickname').value.trim();
            if (nickname === '') {
                showModal("Advertencia", "Por favor, introduce un nickname para comenzar la trivia.");
                return;
            }
            
            triviaNicknameInput.classList.add('hidden');
            triviaContainer.classList.remove('hidden');
            triviaResults.classList.add('hidden');
            currentTriviaQuestionIndex = 0;
            triviaScore = 0;
            renderTriviaQuestion();
        }

        /**
         * Renderiza la pregunta actual de la trivia.
         */
        function renderTriviaQuestion() {
            const questionData = triviaData[currentTriviaQuestionIndex];

            triviaQuestion.textContent = questionData.question;
            triviaOptions.innerHTML = '';
            
            questionData.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'w-full p-3 bg-gray-200 text-gray-800 font-semibold rounded-lg text-left transition-colors duration-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50';
                button.textContent = option;
                button.dataset.answer = option;
                triviaOptions.appendChild(button);
            });

            // Re-bind click events
            triviaOptions.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    selectAnswer(e.target.dataset.answer, questionData.answer);
                });
            });

            submitAnswerBtn.classList.remove('hidden');
            nextQuestionBtn.classList.add('hidden');
            triviaFeedback.classList.add('hidden');
        }

        /**
         * Maneja la selección de una respuesta de trivia.
         * @param {string} selectedOption - La opción seleccionada por el usuario.
         * @param {string} correctAnswer - La respuesta correcta.
         */
        function selectAnswer(selectedOption, correctAnswer) {
            // Deshabilitar todas las opciones
            triviaOptions.querySelectorAll('button').forEach(btn => btn.disabled = true);
            
            let isCorrect = selectedOption === correctAnswer;
            
            // Colorear las opciones
            triviaOptions.querySelectorAll('button').forEach(btn => {
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('bg-green-500', 'text-white');
                    btn.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                } else if (btn.textContent === selectedOption) {
                    btn.classList.add('bg-red-500', 'text-white');
                    btn.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                }
            });

            if (isCorrect) {
                triviaScore += 10;
                triviaFeedback.textContent = "¡Correcto! ✅";
                triviaFeedback.classList.add('text-green-600');
            } else {
                triviaFeedback.textContent = "Incorrecto. ❌ La respuesta correcta era: " + correctAnswer;
                triviaFeedback.classList.add('text-red-600');
            }
            
            triviaFeedback.classList.remove('hidden');
            submitAnswerBtn.classList.add('hidden');
            nextQuestionBtn.classList.remove('hidden');
        }

        /**
         * Pasa a la siguiente pregunta o finaliza la trivia.
         */
        function nextQuestion() {
            currentTriviaQuestionIndex++;
            if (currentTriviaQuestionIndex < triviaData.length) {
                renderTriviaQuestion();
            } else {
                endTrivia();
            }
        }
        
        /**
         * Finaliza la trivia, muestra los resultados y guarda el puntaje localmente.
         */
        function endTrivia() {
            triviaContainer.classList.add('hidden');
            triviaResults.classList.remove('hidden');
            finalScoreSpan.textContent = triviaScore;

            // Guardar el puntaje en el array local
            leaderboardScores.push({ nickname: nickname, score: triviaScore });
            renderLeaderboard();
        }
        
        /**
         * Reinicia el juego de trivia.
         */
        function restartTrivia() {
            triviaResults.classList.add('hidden');
            triviaNicknameInput.classList.remove('hidden');
            document.getElementById('nickname').value = '';
            currentTriviaQuestionIndex = 0;
            triviaScore = 0;
        }
        
        // Manejar el botón de enviar respuesta
        submitAnswerBtn.addEventListener('click', () => {
            const selectedOption = triviaOptions.querySelector('button.bg-red-500, button.bg-green-500')?.dataset.answer;
            if (!selectedOption) {
                showModal("Advertencia", "Por favor, selecciona una respuesta.");
                return;
            }
            // La lógica para la respuesta ya se maneja en el evento de clic de los botones de opción.
            // Este botón solo es un fallback y no necesita una lógica compleja.
        });


        // Eventos de la sección de Trivia
        startTriviaBtn.addEventListener('click', startTrivia);
        nextQuestionBtn.addEventListener('click', nextQuestion);
        restartTriviaBtn.addEventListener('click', restartTrivia);

        // --- Lógica de la interfaz de usuario general ---

        /**
         * Maneja el cambio de pestañas de navegación.
         */
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Elimina la clase 'active' de todas las pestañas y muestra el contenido correcto
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.add('hidden'));

                button.classList.add('active');
                const targetId = button.id.replace('tab-', 'content-');
                document.getElementById(targetId).classList.remove('hidden');
            });
        });

        // Inicializar la aplicación al cargar la página
        document.getElementById('current-year').textContent = new Date().getFullYear();
        renderMusicList();
        renderStoryMilestones();
        renderLeaderboard();
    </script>
</body>
</html>
